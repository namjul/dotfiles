#!/usr/bin/env fish

# set alactitty and neovim darkmode
# parts from https://linuxconfig.org/how-to-obtain-sunrise-sunset-time-for-any-location-from-linux-command-line
# TODO use https://fostips.com/light-dark-command-ubuntu-22-04/

function dark
  nvim-ctrl 'set background=dark'
  alacritty-colorscheme apply gruvbox-dark.yml
  gsettings set org.gnome.desktop.interface color-scheme prefer-dark
  echo 'set background=dark' >~/.vimrc_background
  echo "dark"
end

function light
  nvim-ctrl 'set background=light'
  alacritty-colorscheme apply gruvbox-light.yml
  gsettings set org.gnome.desktop.interface color-scheme prefer-light
  echo 'set background=light' >~/.vimrc_background
  echo "light"
end

argparse --name=my_function 'h/help' 'n/name=' -- $argv

  # setup https://www.latlong.net/
  set latitude "48.208176"
  set longtitue "16.373819"

  set location "$latitude-$longtitue"
  set dayOfYear (date +%j)
  set tmpfile /tmp/$location.$dayOfYear.out

  if not test -e "$tmpfile"
    set result (wget -q -O - "http://api.sunrise-sunset.org/json?lat=$latitude&lng=$longtitue&date=today" | jq -r '.results | {sunrise, sunset} | join("\\\n")')
    if test -n "$result"
      echo "$result" > "$tmpfile"
    else
      echo "nothing"
      return 1
    end
  end

  set SUNR (echo -e (cat "$tmpfile") | head -1)
  set SUNS (echo -e (cat "$tmpfile") | tail -1)

  set sunrise (date --date="$SUNR" +%s)
  set sunset (date --date="$SUNS" +%s)
  set now (date +%s)

  if test "$argv" = "dark"
    dark
    return 1
  else if test "$argv" = "light"
    light
    return 1
  end

  if test "$now" -lt "$sunrise" -o "$now" -gt "$sunset"
    dark
    return 1
  else if test "$now" -gt "$sunrise"
    light
    return 1
  end
or return
